<!DOCTYPE html>
<html>
<head>
  <title>Doodle Jump Clone</title>
  <style>
    body { margin:0; background:#87CEEB; overflow:hidden; }
    canvas { display:block; margin:0 auto; background:#87CEEB; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let gameStarted = false;
let gameOver = false;
let score = 0;

// Load images
const playerImg = new Image();
playerImg.src = 'images/player.png';

const platformImg = new Image();
platformImg.src = 'images/platform.png';

const brokenImg = new Image();
brokenImg.src = 'images/broken.png';

const jetpackImg = new Image();
jetpackImg.src = 'images/jetpack.png';

// Player starts above the first platform
const player = { x:200, y:500, w:40, h:40, dy:0, onGround:false };

// Platforms
let platforms = [];
const platformCount = 8;

// --- Image loading logic ---
let imagesLoaded = 0;
const totalImages = 4;

function imageLoaded(){
    imagesLoaded++;
    if(imagesLoaded === totalImages){
        // All images loaded â†’ start the game
        createPlatforms();
        update();
    }
}

// Attach load events
playerImg.onload = imageLoaded;
platformImg.onload = imageLoaded;
brokenImg.onload = imageLoaded;
jetpackImg.onload = imageLoaded;

// Optional: show loading text while images load
ctx.fillStyle = "black";
ctx.font = "30px Arial";
ctx.textAlign = "center";
ctx.fillText("Loading...", canvas.width/2, canvas.height/2);

// --- Platform creation ---
function createPlatforms() {
  // First platform directly under player
  platforms.push({
    x: player.x - 35,  
    y: player.y + player.h + 10, 
    w: 70,
    h: 15,
    broken: false
  });

  // Remaining platforms
  for(let i = 1; i < platformCount; i++){
    platforms.push({
      x: Math.random()*(canvas.width-70),
      y: player.y + player.h + 10 - i*75,  
      w: 70,
      h: 15,
      broken: false
    });
  }
}

function spawnPlatform(y){
  platforms.push({
    x: Math.random()*(canvas.width-70),
    y: y,
    w:70,
    h:15,
    broken:false
  });
}

// --- Game loop ---
function update(){
  if(!gameStarted) return drawStartScreen();
  if(gameOver) return drawGameOver();

  // Auto jump
  const jumpStrength = 15;
  if(player.onGround) player.dy = -jumpStrength;

  // Gravity
  player.dy += 0.8;
  player.y += player.dy;

  // Collision with platforms
  player.onGround = false;
  for(let p of platforms){
    if(player.x + player.w > p.x && player.x < p.x + p.w &&
       player.y + player.h > p.y && player.y + player.h < p.y + p.h + player.dy){
      player.dy = 0;
      player.y = p.y - player.h;
      player.onGround = true;

      // Chance to break platform
      if(!p.broken && Math.random()<0.2){
        p.broken = true;
      }
    }
  }

  // Scroll screen
  if(player.y < 200){
    let dy = 200 - player.y;
    player.y = 200;
    platforms.forEach(p => p.y += dy);
    score += Math.floor(dy);

    // Remove offscreen
    platforms = platforms.filter(p => p.y < canvas.height);

    // Spawn new platforms to maintain count
    while(platforms.length < platformCount){
      spawnPlatform(-Math.random()*100);
    }
  }

  // Game over
  if(player.y > canvas.height) gameOver = true;

  draw();
  requestAnimationFrame(update);
}

// --- Draw ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Platforms
  platforms.forEach(p=>{
    if(p.broken) ctx.drawImage(brokenImg, p.x, p.y, p.w, p.h);
    else ctx.drawImage(platformImg, p.x, p.y, p.w, p.h);
  });

  // Player
  ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);

  // Jetpack effect
  if(!player.onGround){
    ctx.drawImage(jetpackImg, player.x+player.w/4, player.y+player.h, player.w/2, 15);
  }

  // Score
  ctx.fillStyle='black';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score, 10,30);
}

// --- Start screen ---
function drawStartScreen(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='black';
  ctx.font='40px Arial';
  ctx.textAlign='center';
  ctx.fillText('Auto Jump Doodle', canvas.width/2, 200);
  ctx.font='20px Arial';
  ctx.fillText('Press Enter to Start', canvas.width/2, 300);
  requestAnimationFrame(update);
}

// --- Game over ---
function drawGameOver(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='red';
  ctx.font='40px Arial';
  ctx.textAlign='center';
  ctx.fillText('Game Over', canvas.width/2, 250);
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score, canvas.width/2, 300);
  ctx.fillText('Refresh to Play Again', canvas.width/2, 350);
}

// Start the game when pressing Enter
document.addEventListener('keydown', e=>{
  if(e.key==='Enter') gameStarted = true;
});
</script>
</body>
</html>
