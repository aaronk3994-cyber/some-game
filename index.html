<!DOCTYPE html>
<html>
<head>
  <title>Doodle Jump Jetpack Clone</title>
  <style>
    body { margin:0; overflow:hidden; }
    canvas { display:block; margin:0 auto; background:white; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let gameStarted = false;
let gameOver = false;
let score = 0;
let powerJumps = 5; 
let blocksPassed = 0;

// --- Player setup ---
const player = { 
  x: 200, 
  y: 500, 
  w: 35,  
  h: 35,  
  dy: 0, 
  onGround: false,
  jetActive: false,
  jetTime: 0
};

let platforms = [];
let jetpacks = [];
const platformCount = 8;
const keys = { left:false, right:false, jet:false };

// --- Platforms ---
function createPlatforms() {
  platforms.push({ x: player.x - 25, y: player.y + player.h + 10, w: 70, h: 15, type: 'normal', dir: 1 });
  for(let i = 1; i < platformCount; i++){
    spawnPlatform(player.y + player.h + 10 - i*75);
  }
}

function spawnPlatform(y){
  const moving = Math.random() < 0.2;
  const p = { 
    x: Math.random()*(canvas.width-70), 
    y: y, 
    w:70, 
    h:15, 
    type: 'normal', 
    dir: moving ? 1 : 0,
    speed: moving ? 2 + Math.random()*2 : 0
  };
  platforms.push(p);

  if(Math.random() < 0.15){
    jetpacks.push({ 
      x: p.x + p.w/2 - 12, 
      y: p.y - 30, 
      w: 24, 
      h: 30, 
      active: true, 
      timeLeft: 10000
    });
  }
}

// --- Draw player ---
function drawDoodle(x, y, w, h){
  ctx.fillStyle = '#006400';
  ctx.beginPath();
  ctx.roundRect(x, y, w, h, 8);
  ctx.fill();

  ctx.fillStyle = 'black';
  ctx.beginPath();
  ctx.arc(x + w*0.3, y + h*0.3, 2, 0, Math.PI*2);
  ctx.arc(x + w*0.7, y + h*0.3, 2, 0, Math.PI*2);
  ctx.fill();

  ctx.strokeStyle = 'black';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x + w*0.4, y + h*0.65);
  ctx.lineTo(x + w*0.6, y + h*0.65);
  ctx.stroke();

  ctx.fillStyle = '#2E8B57';
  ctx.fillRect(x + 5, y + h - 4, 8, 5);
  ctx.fillRect(x + w - 13, y + h - 4, 8, 5);

  ctx.fillStyle = 'gray';
  ctx.fillRect(x - 5, y + 8, 5, 15);
}

// --- Game loop ---
let lastTime = performance.now();

function update(time = performance.now()){
  if(!gameStarted) return drawStartScreen();
  if(gameOver) return drawGameOver();

  const delta = time - lastTime;
  lastTime = time;

  const bounceJump = 25; // higher bounce for longer air time
  const playerSpeed = 5;
  const megaJetBoost = 35;
  const gravity = 0.5; // reduced gravity for slower fall

  // Normal bounce jump
  if(player.onGround && !keys.jet && !player.jetActive){
    player.dy = -bounceJump;
  }

  // Mega jetpack boost (spacebar) only if powerJumps > 0
  if(keys.jet && powerJumps > 0){
    player.dy = -megaJetBoost;
    keys.jet = false;
    powerJumps--;
  }

  // Jetpack block boost (10 sec)
  if(player.jetActive){
    player.dy = -10;
    player.jetTime -= delta;
    if(player.jetTime <= 0) player.jetActive = false;
  }

  // Gravity
  player.dy += gravity;
  player.y += player.dy;

  // Horizontal movement
  if(keys.left){
    player.x -= playerSpeed;
    if(!player.onGround) player.dy -= 0.3; // small lift while moving
  }
  if(keys.right){
    player.x += playerSpeed;
    if(!player.onGround) player.dy -= 0.3; 
  }
  if(player.x + player.w < 0) player.x = canvas.width;
  if(player.x > canvas.width) player.x = -player.w;

  player.onGround = false;

  // Platform collision
  platforms.forEach(p=>{
    if(player.x + player.w > p.x && player.x < p.x + p.w &&
       player.y + player.h > p.y && player.y + player.h < p.y + p.h + player.dy){
      player.dy = -bounceJump; 
      player.y = p.y - player.h;
      player.onGround = true;
    }

    // Moving platforms
    if(p.dir !== 0){
      p.x += p.speed * p.dir;
      if(p.x <= 0 || p.x + p.w >= canvas.width) p.dir *= -1;
    }
  });

  // Jetpack blocks
  jetpacks.forEach(j=>{
    if(!j.active) return;
    if(player.x < j.x + j.w && player.x + player.w > j.x &&
       player.y < j.y + j.h && player.y + player.h > j.y){
      j.active = false;
      player.jetActive = true;
      player.jetTime = j.timeLeft;
    }
  });

  // Scroll when player high
  if(player.y < 200){
    let dy = 200 - player.y;
    player.y = 200;
    platforms.forEach(p => p.y += dy);
    jetpacks.forEach(j => j.y += dy);
    score += Math.floor(dy);
    platforms = platforms.filter(p => p.y < canvas.height);
    jetpacks = jetpacks.filter(j => j.y < canvas.height && j.active);
    while(platforms.length < platformCount) spawnPlatform(-Math.random()*100);
  }

  if(player.y > canvas.height) gameOver = true;

  draw();
  requestAnimationFrame(update);
}

// --- Draw ---
function draw(){
  ctx.fillStyle = 'white';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  platforms.forEach(p=>{
    ctx.fillStyle = '#228B22';
    ctx.fillRect(p.x, p.y, p.w, p.h);
  });

  jetpacks.forEach(j=>{
    if(!j.active) return;
    ctx.fillStyle = 'purple';
    ctx.fillRect(j.x, j.y, j.w, j.h);
  });

  drawDoodle(player.x, player.y, player.w, player.h);

  if(player.dy < 0){
    ctx.fillStyle = 'yellow';
    ctx.beginPath();
    ctx.moveTo(player.x + player.w/2 - 5, player.y + player.h);
    ctx.lineTo(player.x + player.w/2 + 5, player.y + player.h);
    ctx.lineTo(player.x + player.w/2, player.y + player.h + 15);
    ctx.fill();
  }

  ctx.fillStyle='black';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score, 10,30);
  ctx.fillText('Mega Boosts Left: '+powerJumps, 10, 60);
  ctx.fillText('Jetpack Active: '+(player.jetActive ? 'Yes' : 'No'), 10, 90);
}

// --- Screens ---
function drawStartScreen(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='black';
  ctx.font='40px Arial';
  ctx.textAlign='center';
  ctx.fillText('Doodle Jump Jetpack', canvas.width/2, 250);
  ctx.font='20px Arial';
  ctx.fillText('Press Enter to Start', canvas.width/2, 300);
  requestAnimationFrame(update);
}

function drawGameOver(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='red';
  ctx.font='40px Arial';
  ctx.textAlign='center';
  ctx.fillText('Game Over', canvas.width/2, 300);
}

// --- Input ---
document.addEventListener('keydown', e=>{
  if(e.key==='Enter') gameStarted = true;
  if(e.key==='ArrowLeft' || e.key==='a') keys.left = true;
  if(e.key==='ArrowRight' || e.key==='d') keys.right = true;
  if(e.key===' ') keys.jet = true;
});

document.addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft' || e.key==='a') keys.left = false;
  if(e.key==='ArrowRight' || e.key==='d') keys.right = false;
  if(e.key===' ') keys.jet = false;
});

createPlatforms();
update();
</script>
</body>
</html>
